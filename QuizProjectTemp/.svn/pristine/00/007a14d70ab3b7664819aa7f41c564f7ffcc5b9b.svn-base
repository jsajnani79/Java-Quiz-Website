package QuizProject;

import java.sql.ResultSet;
import java.sql.SQLException;

import QuizProject.UserPackage.Crypto;
import QuizProject.UserPackage.User;

public class AccountManager {
	
	DBConnection connection;
		
	public AccountManager(DBConnection connection){
		this.connection = connection;
	}
	
	public boolean accountExists(String username) {
		ResultSet rs = this.getAccountForName(username);
		try {
			if (rs.next()) return true;
		} catch (SQLException e) {
			e.printStackTrace();
		}
		return false;
	}
	
	// duplicate functionality in User class
	public boolean checkPassword(String username, String passwordAttempt) {
		ResultSet rs = this.getAccountForName(username);
		try {
			while(rs.next()) {
				String salt = rs.getString("salt");
				String hashedPassword = rs.getString("hasedPassword"); // huge issue!!!!! hasedPassword spelled wrong in DB
				String hashedAttempt = Crypto.generateHash(passwordAttempt, salt);
				if (hashedPassword.equals(hashedAttempt)) return true;
			}
		} catch (SQLException e) {
			e.printStackTrace();
		}
		return false;
	}
	
	public void createAccount(String username, String password) { // should return hydrated user object 
		if (!this.accountExists(username)) {
			String salt = Crypto.generateSalt();

			String update = "INSERT INTO users VALUES(";
			update += "\"" + username + "\",";
			update += "\"" + Crypto.generateHash(password, salt) + "\",";
			update += "\"" + salt + "\",";
			update += "\"FALSE\",";
			update += "\"FALSE\",";
			update += "\"FALSE\",";
			update += "\"FALSE\",";
			update += "\"FALSE\",";
			update += "\"FALSE\",";
			update += "\"FALSE\");";
			this.connection.executeUpdate(update);
		}
	}
	
	private ResultSet getAccountForName(String username) { // shitty name -- yeah adherence to convention is poor here, sm
		return this.connection.executeQuery("SELECT * FROM users WHERE username = \"" + username + "\";");
	}
	
}
