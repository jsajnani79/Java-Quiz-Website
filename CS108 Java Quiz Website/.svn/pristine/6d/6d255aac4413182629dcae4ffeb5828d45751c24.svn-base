<%@ page language="java" contentType="text/html; charset=ISO-8859-1"
    pageEncoding="ISO-8859-1"%>
	<%@ page import="Servlets.*" %>
    <%@ page import="java.util.ArrayList" %>
    <%@ page import="QuizProject.UserPackage.MessagePackage.*" %>
    <%@ page import="QuizProject.DBConnection" %>
    <%@ page import="QuizProject.UserPackage.*" %>
    <%@ page import="QuizProject.QuizPackage.*" %>
    <%@ page import="QuizProject.QuestionPackage.*" %>
    <%@ page import="java.util.Set" %>
    <%@ page import="QuizProject.UserPackage.AchievementPackage.*" %>
    <%@ page import="java.util.Date" %>
    <%@ page import="java.text.SimpleDateFormat" %>
    
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Initialize User -->
<%	 	User user = (User) session.getAttribute(SessionListener.AUTHENTICATED_USER_KEY); 
		int id = Integer.parseInt(request.getParameter("id"));
		Quiz quiz = new Quiz(id, user.getConnection());
		%>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title><%= quiz.getName()%> Summary</title>
<link rel="stylesheet" href="bootstrap/css/bootstrap.css"/>
<link rel="stylesheet" href="QuizletStylesheet.css"/>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://code.jquery.com/jquery.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="bootstrap/js/bootstrap.js"></script>
<style></style>
</head>
<body>

<!-- Print Complete Navigation Bar --> 
<%String fullNavBar = HTMLHelper.generateFullNavBar(user); %>
<%= fullNavBar %>

<div id="main">
<h2><%= quiz.getName()%></h2>
<br>
<h3>Quiz Summary</h3>

<!-- Quiz Description -->
<div class="well">
<h4>Quiz Description</h4>
<%=quiz.getDescription() %>
</div>

<!-- Quiz Creator -->
<p>This quiz was created by <%=HTMLHelper.linkforUser(quiz.getCreator()) %> on <%=Utilities.convertLongToDate(quiz.getDateCreated())%></p>

<!-- Initiate Quiz.  -->
<form action=<%=HTMLHelper.hrefForQuiz(quiz)%>>
<input name="id" type="hidden" value="<%=id%>"/> 
<input name="questionIndex" type="hidden" value="0"/> 
<button type="submit" class="btn btn-default">Start Quiz</button>
</form>
<!-- Initiate Quiz in Practice Mode -->
<button type="submit" class="btn btn-default pull-right">Start Practice Mode</button>
<!-- Edit Quiz, if User is Owner -->

<!-- List of the users past performance on this specific quiz.   -->
<h3>Past Performance</h3>
<div class="panel panel-default">
  <div class="panel-heading">Your Past Performance</div>
  <div class="panel-body">
  <%ArrayList<Score> userPerformance = user.getScoresForQuiz(user.getConnection(), id); %>
  <p><h4>You have taken this quiz a total of <%=userPerformance.size()%> times.</h4></p>
  </div>
  <!-- Table -->
  <table class="table">
     <thead>
	<%	int userPerformerIndex = 1;
	if(userPerformance.size()==0){%>
		<tr><h6 align="center"> There is no performance data to display </h6></tr>
		</thead><tbody>
	<%}else{%>
	
        <tr>
        <th>#</th>
        <th>Score</th>
        <th>Total Time</th>
        <th>Day Taken</th>
      </tr>
    </thead>
    <tbody>
	
	<%for(Score score: userPerformance){%>
	        <tr>
	        <td><%=userPerformerIndex%></td>
	        <td><%=score.getNumericalScore()%></td>
	        <td><%=Utilities.convertLongToTime(score.getDuration())%></td>
	        <td><%=Utilities.convertLongToDate(score.getDateTaken())%></td>
	      </tr>
	<%  userPerformerIndex++;}}	%>	

        </tbody>
  </table>
</div>

<!-- List of the highest performers of all time.  -->
<div class="panel panel-default">
  <div class="panel-heading">All Time Highest Performers</div>

  <!-- Table -->
  <table class="table">
     <thead>
 
 	<%ArrayList<Score> highestPerformers = quiz.getBestAllTimeScores(); 
		int highestPerformerIndex = 1;
		if(highestPerformers.size()==0){%>
		<tr><h6 align="center"> There is no performance data to display </h6></tr>
		</thead><tbody>
	<%}else{%>
	
         <tr>
            <th>#</th>
            <th>User</th>
            <th>Score</th>
            <th>Total Time</th>
            <th>Day Taken</th>
          </tr>
        </thead>
        <tbody>
    
	<%	for(Score score: highestPerformers){%>
	        <tr>
	        <td><%=highestPerformerIndex%></td>
	        <td><%=HTMLHelper.linkforUser(new User(score.getTakerId(), user.getConnection()))%></td>
	        <td><%=score.getNumericalScore()%></td>
	        <td><%=Utilities.convertLongToTime(score.getDuration())%></td>
	        <td><%=Utilities.convertLongToDate(score.getDateTaken())%></td>
	      </tr>
	<%  highestPerformerIndex++;}}	%>	
        </tbody>
  </table>
</div>

<!-- List of top performers in the last day. -->
<div class="panel panel-default">
  <div class="panel-heading">Top Performers in the Last Day</div>
  <!-- Table -->
  <table class="table">
     <thead>
        
	<%ArrayList<Score> intervalPerformers = quiz.getBestIntervalScores(); 
		int intervalPerformerIndex = 1;
		if(intervalPerformers.size()==0){%>
		<tr><h6 align="center"> There is no performance data to display </h6></tr>
		</thead><tbody>
	<%}else{%>
	
         <tr>
            <th>#</th>
            <th>User</th>
            <th>Score</th>
            <th>Total Time</th>
            <th>Day Taken</th>
          </tr>
        </thead>
        <tbody>
    
	<%	for(Score score: intervalPerformers){%>
	        <tr>
	        <td><%=intervalPerformerIndex%></td>
	        <td><%=HTMLHelper.linkforUser(new User(score.getTakerId(), user.getConnection()))%></td>
	        <td><%=score.getNumericalScore()%></td>
	        <td><%=Utilities.convertLongToTime(score.getDuration())%></td>
	        <td><%=Utilities.convertLongToDate(score.getDateTaken())%></td>
	      </tr>
	<%  intervalPerformerIndex++;}	}%>	

        </tbody>
  </table>
</div>

<!-- List showing the performance of recent test takers -->
<div class="panel panel-default">
  <div class="panel-heading">Recent User Performance</div>
  <!-- Table -->
  <table class="table">
     <thead>
        
	<%ArrayList<Score> recentPerformers = quiz.getMostRecentScores(); 
		int recentPerformerIndex = 1;
		if(recentPerformers.size()==0){%>
		<tr><h6 align="center"> There is no performance data to display </h6></tr>
		</thead><tbody>
	<%}else{%>
	
         <tr>
            <th>#</th>
            <th>User</th>
            <th>Score</th>
            <th>Total Time</th>
            <th>Day Taken</th>
          </tr>
        </thead>
        <tbody>
    
	<%	for(Score score: recentPerformers){%>
	        <tr>
	        <td><%=recentPerformerIndex%></td>
	        <td><%=HTMLHelper.linkforUser(new User(score.getTakerId(), user.getConnection()))%></td>
	        <td><%=score.getNumericalScore()%></td>
	        <td><%=Utilities.convertLongToTime(score.getDuration())%></td>
	        <td><%=Utilities.convertLongToDate(score.getDateTaken())%></td>
	      </tr>
	<%  recentPerformerIndex++;}	}%>

        </tbody>
  </table>
</div>

<!-- Summary statistics on how well all users have performed on the quiz.  -->
<div class="panel panel-default">
	  <div class="panel-heading">Overall Performance Statistics</div>
	<!-- Summary List -->
	<% 
	%>
		<ul class="list-group">
			<li class="list-group-item">Highest Score: <%=quiz.getHighestScore() >= 0 ? quiz.getHighestScore() : "Quiz has not yet been taken"%> </li>
			<li class="list-group-item">Lowest Score: <%=quiz.getLowestScore() >= 0 ? quiz.getLowestScore() : "Quiz has not yet been taken"%></li>
			<li class="list-group-item">Average Score: <%=quiz.getMeanScore() >= 0 ? quiz.getMeanScore() : "Quiz has not yet been taken"%></li>
			<li class="list-group-item">Longest Time Taken: <%= quiz.getLongestTime() >= 0 ? Utilities.convertLongToTime(quiz.getLongestTime()) : "Quiz has not yet been taken"%></li>
			<li class="list-group-item">Shortest Time Taken: <%= quiz.getShortestTime() >= 0 ? Utilities.convertLongToTime(quiz.getShortestTime()) : "Quiz has not yet been taken"%></li>
			<li class="list-group-item">Average Time Taken: <%= quiz.getAverageTime() >= 0 ? Utilities.convertLongToTime(quiz.getAverageTime()) : "Quiz has not yet been taken"%></li>
			<li class="list-group-item">Total Times Taken: <%=quiz.getTotalTimesTaken()%></li>
			<li class="list-group-item">Total Time Spent on This Quiz: <%=Utilities.convertLongToTime(quiz.getTotalTimeSpentOnQuiz()) %></li>
		</ul>
	</div>
</div>

</body>
</html>